<?xml version="1.0" encoding="UTF-8"?>

<AttributeResolver
        xmlns="urn:mace:shibboleth:2.0:resolver" 
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
        xsi:schemaLocation="urn:mace:shibboleth:2.0:resolver http://shibboleth.net/schema/idp/shibboleth-attribute-resolver.xsd">


    <!-- ========================================== -->
    <!--      Attribute Definitions                 -->
    <!-- ========================================== -->
	<!-- MOD -->
	<!-- eIDAS mandatory attributes added -->

    <AttributeDefinition id="PersonIdentifier" xsi:type="Simple" sourceAttributeID="PersonIdentifier">
	<Dependency ref="myDatabase" />
        <AttributeEncoder xsi:type="SAML2String" name="http://eidas.europa.eu/attributes/naturalperson/PersonIdentifier" friendlyName="PersonIdentifier" encodeType="false" />
    </AttributeDefinition>

    <AttributeDefinition id="CurrentFamilyName" xsi:type="Simple" sourceAttributeID="FamilyName">
	<Dependency ref="myDatabase" />
        <AttributeEncoder xsi:type="SAML2String" name="http://eidas.europa.eu/attributes/naturalperson/CurrentFamilyName" friendlyName="FamilyName" encodeType="false" />
    </AttributeDefinition>

    <AttributeDefinition id="CurrentGivenName" xsi:type="Simple" sourceAttributeID="FirstName">
	<Dependency ref="myDatabase" />
        <AttributeEncoder xsi:type="SAML2String" name="http://eidas.europa.eu/attributes/naturalperson/CurrentGivenName" friendlyName="FirstName" encodeType="false" />
    </AttributeDefinition>

    <AttributeDefinition id="DateOfBirth" xsi:type="Simple" sourceAttributeID="DateOfBirth">
	<Dependency ref="myDatabase" />
        <AttributeEncoder xsi:type="SAML2String" name="http://eidas.europa.eu/attributes/naturalperson/DateOfBirth" friendlyName="DateOfBirth" encodeType="false" />
    </AttributeDefinition>

    <!-- ========================================== -->
    <!--      Data Connectors                       -->
    <!-- ========================================== -->
    <!-- MOD -->
    <!-- My database connector added -->

    <DataConnector id="myDatabase" xsi:type="RelationalDatabase">
   		<ApplicationManagedConnection 
       		jdbcDriver="com.mysql.jdbc.Driver" jdbcURL="jdbc:mysql://localhost:3306/shibboleth?autoReconnect=true"
       		jdbcUserName="shib" jdbcPassword="paperino" />
   		<QueryTemplate>
       		<![CDATA[
         		SELECT * FROM users WHERE user_name='$resolutionContext.principal'
       		]]>
   		</QueryTemplate>
  
   		<Column columnName="PersonIdentifier" attributeID="PersonIdentifier" />
   		<Column columnName="FamilyName" attributeID="FamilyName" />
   		<Column columnName="FirstName" attributeID="FirstName" />
   		<Column columnName="DateOfBirth" attributeID="DateOfBirth" />
	</DataConnector>

</AttributeResolver>
